name: Create if not exists
description: Create a resource if not exists using az subcommand
inputs:
  resourceName:
    description: Name of the resource
    required: true
  checkCmd:
    description: Command to check if resource exists
    required: true
  createCmd:
    description: Command to create the resource
    required: true
runs:
  using: composite
  steps:
    - name: Create resource if not exists
      shell: bash
      run: |
        set -euo pipefail

        # DEBUG: imprime el comando que se va a ejecutar (quita el echo en production)
        echo "Checking resource '${{ inputs.resourceName }}' with:"
        echo "  checkCmd: ${{ inputs.checkCmd }}"

        # Ejecutar el check de forma segura dentro de bash -c para evitar problemas de parsing
        if bash -lc "${{ inputs.checkCmd }} >/dev/null 2>&1"; then
          echo "âš ï¸ Resource '${{ inputs.resourceName }}' already exists. Skipping creation."
        else
          echo "ğŸš€ Resource '${{ inputs.resourceName }}' not found. Creating..."
          # Ejecutar create tambiÃ©n con bash -c (para soportar comandos multilinea)
          bash -lc "${{ inputs.createCmd }}"
        fi